{% extends 'base.html' %}
{% block title %}测量公差数据设定{% endblock %}

{% block staticfiles %}
{% load staticfiles %}
<link href='{% static "css/bootstrap.min.css" %}' rel="stylesheet">
<link href='{% static "css/style.css" %}' rel="stylesheet">
<link href='{% static "css/select2.css" %}' rel="stylesheet">
<style>
    .table-input {
        border: none;
        width: 80%
    }
</style>
<script type="text/javascript" src='{% static "js/jquery.min.js" %}'></script>
<script type="text/javascript" src='{% static "js/bootstrap.min.js" %}'></script>
<script type="text/javascript" src='{% static "js/select2.min.js" %}'></script>
<script>
    var partition_list;
    window.onload = function () {
        state = '{{state}}';
        if (state == '1') {
            $('span.glyphicon-plus-sign').each(function () {
                this.click();
            });
        }
        partition_list = eval('(' + document.getElementById('json').innerHTML + ')');
        console.log(partition_list);

        document.getElementsByTagName("body")[0].style.overflow = 'auto';
        $('#add_column').tooltip({
            animation: true,
            title: '点击添加一列'
        });
        $('#add_row').tooltip({
            animation: true,
            title: '点击添加一行'
        });
        document.getElementById('style_input').value = window.location.search.length != 0 ? window.location.search.split('?')[1].split('=')[1] : '';
        if ($.trim(document.getElementById('style_input').value) == '') {
            document.getElementById("btn-sub").disabled = true;
        }

        $("#tar select").each(function(i){
            var se = this;
            var v = this.parentNode.getAttribute("value");
            if ((i % 3) == 0){
                $(se).val(parseFloat(v.split("@")[0]).toFixed(1));
            }else if ((i % 3) == 1){
                $(se).val(parseFloat(v.split("@")[1]).toFixed(1));
            }else{
                $(se).val(v);
            }
            
        });
        
        bind_inputs();
        on_change_quick_add(document.getElementById("quick_add_selection"));
        if (window.location.hash == '#copyfrom'){
            document.getElementById("add_on_area").innerHTML = '';
            document.getElementById("style_input").value = "";
            document.getElementById("style_input").setAttribute("placeholder","输入新款号");
            document.getElementById("make_query_btn").setAttribute("disabled","disabled");
            return ;
        }
        var is_mine = parseInt(document.getElementById("changeable").getAttribute("value"));
        if (!is_mine){
            //$("button[innerHTML != '查询']").hide();
             document.getElementById("btn-sub").disabled = true;
            document.getElementById("btn-sub").innerHTML = "锁定";
            document.getElementById("submit_to_check_btn").style.display = 'none';
             $("#scroll_div input").attr("readonly", "readonly");
             $("#scroll_div a").remove();
             $("#scroll_div select").attr("disabled","disabled");
             $(":checkbox").each(function(){
                this.disabled = true;
             });
        }
        if(window.location.hash == '#check'){
            //$("button[innerHTML != '查询']").hide();
            document.getElementById("btn-sub").disabled = true;
            document.getElementById("btn-sub").innerHTML = "锁定";
            $("#scroll_div input").attr("readonly", "readonly");
            $("#scroll_div a").remove();
            $("#scroll_div select").attr("disabled","disabled");
            $(":checkbox").each(function(){
               this.disabled = true;
            });
            $("#submit_to_check_btn").hide();
            $("#btn-sub").hide();
            $("<button>通过</button>").addClass("btn btn-success").click(function(){
                $.ajax({
                    url:"/pass_style_measure",
                    data:{
                        state:1,
                        styleno:document.getElementById("style_input").value
                    },
                    success:function(){
                        alert("该单通过成功");
                    }
                });
            }).appendTo($("#submit_to_check_btn").parent());
            $("<button>不通过</button>").addClass("btn btn-danger").click(function(){
                $.ajax({
                    url:"/pass_style_measure",
                    data:{
                        state:2,
                        styleno:document.getElementById("style_input").value
                    },
                    success:function(){
                        alert("该单退回成功");
                    }
                });
            }).appendTo($("#btn-sub").parent());
            return ;
        }
        if (document.getElementById("state_infoo").getAttribute("value") == '1' || document.getElementById("state_infoo").getAttribute("value") == '0'){
            document.getElementById("btn-sub").disabled = true;
            document.getElementById("btn-sub").innerHTML = "锁定";
            document.getElementById("submit_to_check_btn").style.display = 'none';
            $("#controller button:gt(0)").attr("disabled","disabled");
            $("#scroll_div input").attr("readonly", "readonly");
            $("#scroll_div a").remove();
            $("#scroll_div select").attr("disabled","disabled");
            $(":checkbox").each(function(){
               this.disabled = true;
            });
        }
    };
    function div_update(){
        document.getElementById('scroll_div').scrollTo(100000000,10000000);
    }
    function remove_col(n) {
        n.parentNode.setAttribute('marked', '1');
        var index = 0;
        var ths = document.getElementById('tar').getElementsByTagName('th');
        for (var i = 0; i < ths.length; i++) {
            if (ths[i].getAttribute('marked') == '1') {
                index = i;
            }
        }
        document.getElementById("tar").getElementsByTagName('tr')[0].removeChild(n.parentNode);
        $('#tar tbody tr').each(function () {
            this.removeChild(this.getElementsByTagName('td')[index]);
        });
    }
    function add_col() {
        function calc_value(node,value){
            if (value > 0){
                //console.log(node);
                var pre = $(node).prev()[0];
                console.log(pre);
                if(parseFloat(pre.getElementsByTagName("input")[0].value)>0) {
                    node.getElementsByTagName("input")[0].value = (parseFloat(pre.getElementsByTagName("input")[0].value) + value).toFixed(1);
                }
            }
        }
        var thead = document.getElementById('tar').getElementsByTagName('tr')[0];
        var td = document.createElement('th');
        td.style.border = '1px solid #ddd';
        td.style.minWidth = '110px';
        td.style.maxWidth = '110px';
        td.innerHTML = '<a style="cursor:pointer;display: inline" class="remove_col" onclick="return remove_col(this)"> <span class="glyphicon glyphicon-minus-sign"> </span></a><input PLACEHOLDER="尺码" class="table-input" style="display: inline;width:60%;MARGIN-LEFT:5PX"/>';
        var th = thead.getElementsByTagName('th')[thead.getElementsByTagName('th').length - 1];
        th.style.display = 'none';
        $(th).slideDown('slow');
        thead.insertBefore(td, th);
        $('a.remove_col').tooltip({
            animation: true,
            title: '点击删除此列'
        });
        $('#tar tbody tr').each(function () {
            var td = document.createElement('td');
            td.innerHTML = '<input class="table-input" placeholder="/"/>';
            var th = this.getElementsByTagName('td')[thead.getElementsByTagName('th').length - 2];
            this.insertBefore(td, th);
            calc_value(td,parseFloat(th.getElementsByTagName("input")[0].value));
            
        });
        bind_inputs();
        console.log(document.getElementById("scroll_div").scrollLeft);
        document.getElementById("scroll_div").scrollLeft = '1000';
        //$('#scroll_div').scroll(-100000);
    }
    function bind_inputs(){
        $("td").find("input:first").keydown(function(e){
            var tar = this;
            if (e.keyCode == 38){
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (this == tar){
                        //console.log(i);
                        lineno = i;
                    }
                });
                var temp = $(this).parents("tr:first").prev("tr");
                if (temp.length != 0){
                    temp.find("input").each(function(i){
                        if (i == lineno){
                            $(this).focus();
                        }
                    });
                }else{
                    lineno = lineno - 3;
                    temp = $(this).parents("table:first").find("tr:first").find("input").each(function(i){
                        
                        if (lineno<0){
                            if (i == 0){
                                $(this).focus();
                                return false;
                            }
                        }else{
                            if (i == lineno){
                                $(this).focus();
                                return false;
                            }
                        }
                    });
                }
            }else if (e.keyCode == 40){
                
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (this == tar){
                        //console.log(i);
                        lineno = i;
                    }
                });
                var temp = $(this).parents("tr:first").next("tr");
                if (temp.length != 0){
                    temp.find("input").each(function(i){
                        if (i == lineno){
                            $(this).focus();
                        }
                    });
                }else{

                    temp = $(this).parents("table:first").find("tbody:first").find("tr:first").find("input").each(function(i){
                        lineno = lineno + 3;
                        if (lineno<0){
                            if (i == 0){
                                $(this).focus();
                                return false;
                            }
                        }else{
                            if (i == lineno){
                                $(this).focus();
                                return false;
                            }
                        }
                    });
                }
            }else if (e.keyCode == 39){
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    if (lineno+1 == i){
                        $(this).focus();
                    }
                    if (this == tar){
                        //console.log(i);
                        lineno = i;

                    }
                });

            }else if (e.keyCode == 37){
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (this == tar){
                        //console.log(i);
                        lineno = i;
                    }
                });
                console.log(lineno);
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (lineno-1 == i){
                        $(this).focus();
                    }
                });
            }
        });
        $("th").find("input:first").keydown(function(e){
            var tar = this;
            if (e.keyCode == 38){
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (this == tar){
                        //console.log(i);
                        lineno = i;
                    }
                });
                var temp = $(this).parents("tr:first").prev("tr");
                if (temp.length != 0){
                    temp.find("input").each(function(i){
                        if (i == lineno){
                            $(this).focus();
                        }
                    });
                }else{
                    lineno = lineno - 3;
                    temp = $(this).parents("table:first").find("tr:first").find("input").each(function(i){
                        if (lineno<0){
                            if (i == 0){
                                $(this).focus();
                                return false;
                            }
                        }else{
                            if (i == lineno){
                                $(this).focus();
                                return false;
                            }
                        }
                    });
                }
            }else if (e.keyCode == 40){
                
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (this == tar){
                        //console.log(i);
                        lineno = i;
                    }
                });
                var temp = $(this).parents("tr:first").next("tr");
                if (temp.length != 0){
                    temp.find("input").each(function(i){
                        if (i == lineno){
                            $(this).focus();
                        }
                    });
                }else{
                    lineno = lineno + 3;
                    temp = $(this).parents("table:first").find("tbody:first").find("tr:first").find("input").each(function(i){
                        
                        if (lineno<0){
                            if (i == 0){
                                $(this).focus();
                                return false;
                            }
                        }else{
                            if (i == lineno){
                                $(this).focus();
                                return false;
                            }
                        }
                    });
                }
            }else if (e.keyCode == 39){
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    if (lineno+1 == i){
                        $(this).focus();
                    }
                    if (this == tar){
                        //console.log(i);
                        lineno = i;

                    }
                });

            }else if (e.keyCode == 37){
                var lineno = 0;
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (this == tar){
                        //console.log(i);
                        lineno = i;
                    }
                });
                console.log(lineno);
                $(this).parents("tr:first").find("input").each(function(i){
                    //console.log(this);
                    if (lineno-1 == i){
                        $(this).focus();
                    }
                });
            }
        });
    }
    function add_row(name) {
        var length = document.getElementById("tar").getElementsByTagName('th').length - 3;
        var tr = document.createElement("tr");
        var td = document.createElement('td');
        td.innerHTML = '<a style="cursor:pointer;display: inline" class="remove_row" onclick="this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode)"> <span class="glyphicon glyphicon-minus-sign"> </span></a>';
        var select = document.createElement('input');
        select.type = 'text';
        select.setAttribute('list', 'partition_list_data');
        select.style.marginLeft = '10px';
        select.style.width = '70%';
        select.value = name;
        td.appendChild(select);
        var check = document.createElement('input');

        check.type = 'checkbox';
        check.style.marginLeft = '10px';
        check.innerHTML = "3";
        td.style.position = 'absolute';
        td.style.width = '150px';
        td.style.height = '39px';
        td.style.backgroundColor = 'rgba(238, 238, 238, 0.8)';
        tr.appendChild(td);
        var td2 = document.createElement("td");
        td2.appendChild(check);
        var span = document.createElement("span");
        span.innerHTML = "测量";
        td2.appendChild(span);
        tr.appendChild(td2);

        for (var i = 0; i <= length; i++) {
            var td = document.createElement("td");

            
            if(i == length){
                td.innerHTML += '<input class="table-input" placeholder="均差"/>';
            }else if (i == 0 || i==1){
                td.innerHTML = '<select name="" id=""><option value=""></option><option >0.1</option><option >0.2</option><option >0.3</option><option >0.4</option><option >0.5</option><option >0.6</option><option >0.7</option><option >0.8</option><option >0.9</option><option >1.0</option><option >1.1</option><option >1.2</option><option >1.3</option><option >1.4</option><option >1.5</option><option>1.6</option><option>1.7</option><option>1.8</option><option>1.9</option><option>2.0</option><option>2.1</option><option>2.2</option><option>2.3</option><option>2.4</option><option>2.5</option><option>2.6</option><option>2.7</option><option>2.8</option><option>2.9</option><option>3.0</option></select>';
            }else if (i == 2){
                td.innerHTML = '<select name="" id=""><option value=""></option><option >0.1</option><option >0.2</option><option >0.3</option><option >0.4</option><option >0.5</option><option >0.6</option><option >0.7</option><option >0.8</option><option >0.9</option><option >1.0</option><option >1.1</option><option >1.2</option><option >1.3</option><option >1.4</option><option >1.5</option><option>1.6</option><option>1.7</option><option>1.8</option><option>1.9</option><option>2.0</option><option>2.1</option><option>2.2</option><option>2.3</option><option>2.4</option><option>2.5</option><option>2.6</option><option>2.7</option><option>2.8</option><option>2.9</option><option>3.0</option></select>';
            }else {
                td.innerHTML += '<input class="table-input" placeholder="/"/>';
            }
            tr.appendChild(td);
        }
        document.getElementById("tar").getElementsByTagName('tbody')[0].appendChild(tr);
        $('a.remove_row').tooltip({
            animation: true,
            title: '点击删除此行'
        });
        check.checked = true;
        bind_inputs();
        //console.log(check.checked);
    }
    var temp_id = 1;
    function get_id() {
        return temp_id += 1;
    }
    function submit(n) {
        var size_map = [];
        var size_row = document.getElementById('tar').getElementsByTagName('th');
        if (size_row.length <= 6) {
            alert('请添加至少一个尺码的尺寸');
            return;
        }
        for (var i = 6; i < size_row.length - 1; i++) {
            if ($.trim(size_row[i].getElementsByTagName('input')[0].value) == '') {
                alert('有尺码不明确，请填写完整后提交');
                return;
            }
            for (var j = 0; j < size_map.length; j++) {
                if ($.trim(size_row[i].getElementsByTagName('input')[0].value) == size_map[j]) {
                    alert('有尺码重复');
                    return;
                }
            }
            size_map.push($.trim(size_row[i].getElementsByTagName('input')[0].value));
        }
        var data;
        var partions = [];
        var is_legal = true;
        var is_legal_2 = true;
        $('#tar tbody tr').each(function (e,i) {
            for (var i = 0; i < partions.length; i++) {
                if (this.getElementsByTagName('input')[0].value == partions[i].name) {
                    is_legal = false;
                }
            }
            var is_need = this.getElementsByTagName('input')[1].checked;
            var balance_error = $.trim(this.getElementsByTagName('select')[2].value) != '' ? $.trim(this.getElementsByTagName('select')[2].value) : null;
            var common_difference = ($.trim(this.getElementsByTagName('select')[0].value) != '' ? $.trim(this.getElementsByTagName('select')[0].value) : null) + '@' + ($.trim(this.getElementsByTagName('select')[1].value) != '' ? $.trim(this.getElementsByTagName('select')[1].value) : null);
            var res = [];
            var set_res = this.getElementsByTagName('input');
            for (var i = 3; i < set_res.length; i++) {
                res.push({
                    'size': size_map[i - 3],
                    'data': $.trim(set_res[i].value) != '' ? parseFloat($.trim(set_res[i].value)) : null,
                    'size_index':i-3
                });
            }
            partions.push({
                'name': this.getElementsByTagName('input')[0].value,
                'is_need': is_need,
                'balance_error': balance_error,
                'common_difference': common_difference,
                'hint': $.trim(set_res[2].value),
                'index':e,
                'res': res

            });
            // if ($.trim(common_difference) == ""){

            //     is_legal_2 = false;
            //     return false;
            // }
        });
        if (!is_legal_2){
            alert("公差不能为空");
            return false;
        }
        for (var i = 0; i < partions.length; i++) {
            if (partions[i].name == '') {
                alert('有部位名为空');
                return false;
            }
        }
        if (!is_legal) {
            alert('部位存在重复');
            return false;
        }
        data = {
            'new_style': document.getElementById('style_input').value,
            'old_style': window.location.search.split('?')[1].split('=')[1] ? window.location.search.split('?')[1].split('=')[1] : null,
            'type_id': null,
            'data': partions
        };
        if (window.location.hash == '#copyfrom'){
            data.old_style = null;
        }
        if (data.new_style == '') {
            alert('请填写款号');
            return false;
        }
        $.ajax({
            success: function (e) {
                
                if (!n){
                    return ;
                }
                if (e == '0'){
                    alert('已存在此款号');
                    return ;
                }else if (e == '1'){
                    alert('保存成功');
                }
                if(window.location.hash == '#copyfrom'){
                    window.close();
                }

            },
            error: function (e) {
                console.log(e);
                alert('系统发生错误，请稍后再试，频繁出现请联系管理员');
            },
            url: '/submit_style_measure/',
            type: 'POST',
            data: 'json=' + JSON.stringify(data),
            timeout: 5000,
            async:n
        });
        return true;
    }
</script>

{% endblock %}

{% block other %}
<div class="row clearfix area" id="controller">
    <datalist id="json">
        {{measure_list_json}}
    </datalist>
 
    <div class="col-md-2">
        产品款号：
        <form action="/style_measure/" style="display: inline">

            <input name="style" class="form-control" style="width:100px;display: inline" id="style_input"/>

        </form>
    </div>
    <div class="col-md-1">
        <button class="btn btn-info" onclick="query_style()" id="make_query_btn">查询</button>
    </div>
    <script>
        function query_style() {
            document.getElementsByTagName('form')[0].submit(true);
        }
        function on_change_quick_add(n){
            document.getElementById("partition_list_data").innerHTML = document.getElementById(n.value).innerHTML;
        }
    </script>

    <div class="col-md-1">
        <select class="form-control" id="quick_add_selection" onchange="on_change_quick_add(this)">
            {% for temp in measure_list %}
            <option>{{temp.name}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-1">
        {% ifequal state 0 %}
            <button disabled="disabled" onclick="quick_append_partition()" class="btn btn-primary">+部位</button>
        {% else %}
            <button  class="btn btn-primary" onclick="quick_append_partition()">+部位</button>
        {% endifequal %}
    </div>
    <script>
        function quick_append_partition(){
            if (state == '1'){
                $('a.remove_row').each(function(){
                    this.click();
                });
            }
            document.getElementById("partition_list_data").innerHTML = document.getElementById(document.getElementById("quick_add_selection").value).innerHTML;
            var target = document.getElementById("quick_add_selection").value;
            //console.log(target);
            $('#partition_list_data option').each(function(){
               if (this.getAttribute('label') == target){
                   add_row(this.value);
               }
            });
        }
    </script>

    <div class="col-md-1">
        <select name="" id="quick_size_choose" class="form-control">
            <option value="">尺码</option>
            {% for temp in common_size_list %}
                <option value="{{temp.value}}">{{temp.name}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-1">
        <button class="btn btn-primary" onclick="quick_add_size()">+尺码</button>
    </div>
    <script>
        function quick_fill_data(){
            $("#tar tbody tr").each(function(){
                var inputs = this.getElementsByTagName("input");
                var base = parseFloat(inputs[inputs.length-1].value);
                var start = parseFloat(inputs[3].value);
                for (var i = 4;i<inputs.length-1;i++){

                    if (inputs[3].value == "" || inputs[inputs.length-1].value == ""){
                        //
                    }else{
                        inputs[i].value = ((i-3)*base+start).toFixed(1);
                    }
                }
            });
        }
    </script>
    <div class="col-md-1">
        <datalist id="changeable" value="{{is_mine}}"></datalist>
        <button class="btn btn-primary" id="quick_fill_data" onclick="quick_fill_data()">均差填充</button>
    </div>
    <script>
        function quick_add_size () {
            // body...
            var list = document.getElementById("quick_size_choose").value.split(",");
            for (var i=0;i<list.length;i++){
                var th = document.getElementById("tar").getElementsByTagName("th")[document.getElementById("tar").getElementsByTagName("th").length -2];
                if (th.getElementsByTagName("input")[0].value == ""){
                    th.getElementsByTagName("input")[0].value = list[i];
                }else{
                    document.getElementById("add_column").click();
                    th = document.getElementById("tar").getElementsByTagName("th")[document.getElementById("tar").getElementsByTagName("th").length -2];
                    th.getElementsByTagName("input")[0].value = list[i];
                }
            }
        }
        function submit_to_check(){
            if (!submit(false)){
                return ;
            }
            $.ajax({
                url:"/commit_style_measure/",
                data:{"styleno":document.getElementById("style_input").value},
                success:function(){
                    alert("提交成功，请等待审核");
                    if(window.location.hash == '#copyfrom'){
                        window.close();
                    }
                    window.location.reload(1);
                }
            });
        }
    </script>
    
    <div class="col-md-1">
        <button id="sync_size" class="btn btn-success" onclick = "return sync_size();"><span class="glyphicon glyphicon-refresh"></span> 同步</button>
    </div>
    <script>
        function sync_size () {
            $.ajax({
                url:'/sync_size/',
                success:function(e){
                    for (var i = 0;i<e.length;i++){
                        var exist = false;
                        $("a.remove_col").each(function(){
                            if ($.trim(this.parentNode.getElementsByTagName("input")[0].value) == e[i]){
                                exist = true;
                            }
                        });
                        console.log(exist);
                        if (!exist){
                            var has_empty = false;
                            //$("#add_column").trigger("click");
                            $("#tar").find("thead").find("input").each(function(){
                                if (this.value == ""){
                                    has_empty = true;
                                    this.value = e[i];
                                    return false;
                                }
                            });
                            if (!has_empty){
                                $("#add_column").trigger("click");
                                $("#tar").find("thead").find("input").each(function(){
                                    if (this.value == ""){
                                        has_empty = true;
                                        this.value = e[i];
                                        return false;
                                    }
                                });
                            }
                        }
                    }
                },
                error:function(e){
                    alert("错误，请重试");
                },
                data:{
                    styleno:document.getElementById("style_input").value
                },
                async:false,
                cache:false,
                dataType:"json"
            });
        }
    </script>
    <div class="col-md-1">
        
    </div>
    <div class="col-md-1">
        <button class="btn btn-success" id="btn-sub" onclick="return submit(true)">保存</button>
    </div>
     <div class="col-md-1">
        <button class="btn btn-warning" onclick="return submit_to_check()" id="submit_to_check_btn">提交</button>
    </div>
</div>
<div class="area" id="scroll_div" style="margin-top: 20px;overflow-x: auto">
    <div>
        <div class="" style="">
            <table class="table table-bordered" style="border: none;max-width: 10000px;width: 100px;" id="tar">
                <thead>
                <tr>
                    <th class="table-h"
                        style="border-bottom:1px solid #ddd;border-top:1px solid #ddd;width:130px;min-width: 150px;height: 39px">部位名
                    </th>
                    <th class="table-h"
                        style="border-bottom:1px solid #ddd;border-top:1px solid #ddd;width:80px;min-width: 80px">要求
                    </th>
                    <th class="table-h"
                        style="border-bottom:1px solid #ddd;border-top:1px solid #ddd;width:60px;min-width: 60px">正公差
                    </th>
                    <th class="table-h"
                        style="border-bottom:1px solid #ddd;border-top:1px solid #ddd;width:60px;min-width: 60px">负公差
                    </th>
                    <th class="table-h"
                        style="border-bottom:1px solid #ddd;border-top:1px solid #ddd;width:60px;min-width: 60px">对称
                    </th>
                    <th class="table-h"
                        style="border-bottom:1px solid #ddd;border-top:1px solid #ddd;width:150px;min-width: 150px">备注
                    </th>
                    {% for temp in size_list %}
                    <th style="border-bottom:1px solid #ddd;border-top:1px solid #ddd;min-width: 110px;max-width: 110px">
                        <a style="cursor:pointer;display: inline" class="remove_col" onclick="return remove_col(this)">
                            <span class="glyphicon glyphicon-minus-sign col_miu"> </span></a>
                        <input class="table-input" value="{{temp}}" style="width:60%"/>
                    </th>
                    {% endfor %}
                    <th class="table-h" style="border: none;min-width:50px"><a id="add_column" style="cursor: pointer"
                                                                onclick="return add_col()"><span
                            class="glyphicon glyphicon-plus-sign"></span></a></th>

                </tr>
                </thead>
                <tbody>
                {% for temp in res %}
                <tr>

                    <td style="background-color: rgba(238, 238, 238, 0.8);position: absolute;max-width: 150px;height: 39px">
                        <a style="cursor:pointer;display: inline" class="remove_col"
                           onclick="this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode)">
                            <span class="glyphicon glyphicon-minus-sign row_miu"> </span>
                        </a>
                        <input class="" style="width:70%;margin-left: 5px;" list="partition_list_data"
                               value="{{temp.partition}}" type="text"/>
                    </td>
                    <td>
                        {% ifequal temp.measure_or_not 1 %}
                        <div><input type="checkbox" style="margin-left: 10px" checked="checked"/>测量</div>
                        {% else %}
                        <div><input type="checkbox" style="margin-left: 10px"/>测量</div>
                        {% endifequal %}
                    </td>
                    <td value = "{{temp.common}}">
                        <!-- <input class="table-input" value="{{temp.common}}"/> -->
                        <select name="" id="">
                            <option value=""></option>
                            <option >0.1</option>
                            <option >0.2</option>
                            <option >0.3</option>
                            <option >0.4</option>
                            <option >0.5</option>
                            <option >0.6</option>
                            <option >0.7</option>
                            <option >0.8</option>
                            <option >0.9</option>
                            <option >1.0</option>
                            <option >1.1</option>
                            <option >1.2</option>
                            <option >1.3</option>
                            <option >1.4</option>
                            <option >1.5</option>
                            <option >1.6</option>
                            <option >1.7</option>
                            <option >1.8</option>
                            <option >1.9</option>
                            <option >2.0</option>
                            <option >2.1</option>
                            <option >2.2</option>
                            <option >2.3</option>
                            <option >2.4</option>
                            <option >2.5</option>
                            <option >2.6</option>
                            <option >2.7</option>
                            <option >2.8</option>
                            <option >2.9</option>
                            <option >3.0</option>
                        </select>
                    </td>
                    <td value = "{{temp.common}}">
                        <!-- <input class="table-input" value="{{temp.common}}"/> -->
                        <select name="" id="">
                            <option value=""></option>
                            <option >0.1</option>
                            <option >0.2</option>
                            <option >0.3</option>
                            <option >0.4</option>
                            <option >0.5</option>
                            <option >0.6</option>
                            <option >0.7</option>
                            <option >0.8</option>
                            <option >0.9</option>
                            <option >1.0</option>
                            <option >1.1</option>
                            <option >1.2</option>
                            <option >1.3</option>
                            <option >1.4</option>
                            <option >1.5</option>
                            <option >1.6</option>
                            <option >1.7</option>
                            <option >1.8</option>
                            <option >1.9</option>
                            <option >2.0</option>
                            <option >2.1</option>
                            <option >2.2</option>
                            <option >2.3</option>
                            <option >2.4</option>
                            <option >2.5</option>
                            <option >2.6</option>
                            <option >2.7</option>
                            <option >2.8</option>
                            <option >2.9</option>
                            <option >3.0</option>
                        </select>
                    </td>
                    <td value = "{{temp.symmetry}}">
                        <!-- <input class="table-input" value="{{temp.symmetry}}"/> -->
                        <select name="" id="">
                            <option value=""></option>
                            <option >0.1</option>
                            <option >0.2</option>
                            <option >0.3</option>
                            <option >0.4</option>
                            <option >0.5</option>
                            <option >0.6</option>
                            <option >0.7</option>
                            <option >0.8</option>
                            <option >0.9</option>
                            <option >1.0</option>
                            <option >1.1</option>
                            <option >1.2</option>
                            <option >1.3</option>
                            <option >1.4</option>
                            <option >1.5</option>
                            <option >1.6</option>
                            <option >1.7</option>
                            <option >1.8</option>
                            <option >1.9</option>
                            <option >2.0</option>
                            <option >2.1</option>
                            <option >2.2</option>
                            <option >2.3</option>
                            <option >2.4</option>
                            <option >2.5</option>
                            <option >2.6</option>
                            <option >2.7</option>
                            <option >2.8</option>
                            <option >2.9</option>
                            <option >3.0</option>
                        </select>
                    </td>
                    <td><input class="table-input" value="{{temp.hint}}"/></td>
                    {% for data in temp.data %}
                    <td><input class="table-input" value="{{data.no}}"/></td>
                    {% endfor %}
                    <td><input class="table-input" type="text" placeholder="均差"/></td>
                </tr>
                {% endfor %}
                </tbody>
                <tfoot>
                <tr>
                    <td style="border:none"><a id="add_row" style="cursor: pointer" onclick="add_row('')"><span
                            class="glyphicon glyphicon-plus-sign"></span></a></td>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
<div id="add_on_area">
    

{% ifequal state 2 %}
    此单据由{{measure_employee}}录入
{% endifequal %}
<span id="state_infoo" value="{{measure_state}}">
{% ifequal measure_state 2 %}
    {% ifequal measure_assessor "" %}
        未提交
    {% else %}
        由<span style="color:blue">{{measure_assessor}}</span>于 <span style="color:red">{{assessor_time}}</span> 退回
    {% endifequal %}
{% endifequal %}
{% ifequal measure_state 0 %}
    审核中
{% endifequal %}
{% ifequal measure_state 1 %}
    由<span style="color:blue">{{measure_assessor}}</span>于 <span style="color:red">{{assessor_time}}</span> 通过 
{% endifequal %}


</span>
{% ifequal measure_state 0 %}
    <a href="#copyfrom" target="_blank" id="copyfrom">从此款复制</a> 
{% endifequal %}
{% ifequal measure_state 1 %}
    <a href="#copyfrom" target="_blank" id="copyfrom">从此款复制</a> 
{% endifequal %}
</div>
</div>
<datalist id="partition_list_data">

</datalist>

{% for temp in measure_list %}
    <datalist id="{{temp.name}}">
        {% for i in temp.partition_list %}
            <option value="{{i}}" label="{{temp.name}}">{{i}}</option>
        {% endfor %}
    </datalist>
{% endfor %}
</body>
{% endblock %}